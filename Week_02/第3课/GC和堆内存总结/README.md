### 堆内存

Java堆是被所有线程共享的一块内存区域，所有对象和数组都在堆上进行分配。

对象包含三部分：

- 对象头：
标记字（1byte）、Class指针（1byte）、数组长度（int）。

- 实例数据：
属性字段。

- 对齐填充：
为了高效寻址，空间换时间。

常见的占内存：

- 包装类型

- 多维数组：存放嵌套数组的引用占额外的空间。

- String：可以用char[]代替。

GC的一般原理包括：

- 引用追踪：
Java不能直接操作内存，不被引用的垃圾肯定不会再被使用。

- 分代假设：
大部分新生对象很快无用，存活时间久的对象可能存活更长时间。基于这种特性，将内存划分为新生代和老年代进行管理，`Minor GC` 一般要比 `Major GC` 频繁得多。

- STW：
GC暂停主要为了防止两种情况：1、标记过程中，某个对象不被依赖了，但是已经被标记过了，该回收的没回收；2、标记过程中，某些新对象依赖旧对象，但是旧对象已经遍历过了，这些新对象不会再被标记，不该回收的回收了。随着屏障技术和GC算法的发展，STW的时间会越来越短。

PrintGCDetails的分析
- 复制日志信息，使用GC easy等工具分析。

- 分配速率：
每次GC，年轻代新增的使用量除以时间间隔。如果分配速率很高甚至大于回收速率，很有可能导致GC开销大甚至OOM。

- 提升速率：
每次GC，从年轻代提升到老年代的数量除以时间间隔。提升速率很高可能是to区太小、大对象、存活次数阈值小导致的。老年代填充越快，`Major GC`发生的频率越高。

### SerialGC

### ParallelGC

### CMSGC

### G1GC
